# BitDash Firestudio

> Simple Bitcoin & SPX Trading Dashboard

## Overview

Personal dashboard for tracking Bitcoin and SPX/SPY price action and technical indicators to inform trading decisions.

See [docs/SETUP_QUICKSTART.md](docs/SETUP_QUICKSTART.md) for a short setup guide.

### Features

- BTC/USD and SPX/SPY price charts
- Key technical indicators (RSI, Moving Averages, MACD)
- Clean, focused interface

## Tech Stack

- Next.js 14
- React 18
- TypeScript
- Lightweight charting
- Tailwind CSS
- All backend logic handled directly by Next.js API routes

## Getting Started

Ensure **Node.js 18** is installed before continuing.

1. Clone the repository:

   ```bash
   git clone https://github.com/yourusername/bitdash-firestudio.git
   cd bitdash-firestudio
   ```

2. Install Node 18 and dependencies:

   ```bash
   nvm install 18
   nvm use 18
   npm ci
   ```

3. Install dev tools:
   ```bash
   npm run setup
   ```

4. Set up git hooks (pre-commit and post-commit):
   ```bash
   npm run setup-hooks
   ```
5. Commits must follow Conventional Commits with a subject like `Task 123:`. A
   `commit-msg` hook runs `commitlint` to enforce this format.

6. Start the development server:
   ```bash
   npm run dev
   ```

## Usage

1. Open [http://localhost:3000](http://localhost:3000)
2. View price charts for BTC and SPX/SPY
3. Monitor technical indicators

### Macro Data Refresh Demo

For a simple example that fetches macro data only when you click refresh, visit
`/refresh-demo` after starting the development server. This page displays the
current US Dollar Index (DXY) and 10-Year Treasury Yield using the free FRED
API through the project's API routes. DXY data is cached for 15 minutes on the
server to respect rate limits. Most other API calls use a shared 15-second
cache via `src/lib/constants.ts` so repeated requests don't hammer upstream
services.

## Data Sources

- Price data from public APIs
- Updates every 5 minutes
- Simple error handling and retries

## Project Structure

```
/app
  /dashboard      # Main dashboard page
  /api           # API routes
/components
  /charts        # Chart components
  /indicators    # Technical indicators
/lib
  /data          # Data fetching
  /utils         # Helper functions
/public         # Static assets
```

## Configuration

### ESLint

This repo uses both a classic `.eslintrc.json` and a flat `eslint.config.js`.
The `npm run lint` script sets `ESLINT_USE_FLAT_CONFIG=false` and loads `.eslintrc.json`. Tools that understand the flat config may import `eslint.config.js` directly. Keep custom rules in sync across both files.



## Development

```bash
# Start dev server
npm run dev

# Build for production
npm run build

# Start production server
npm start
```

## License

MIT

## Backtest Results

Using 5-minute BTC data from CoinGecko (90 days) the strategy achieved roughly a 55% win rate on historical candles. Run `npm run backtest` to reproduce.

## Continuous Integration

GitHub Actions run lint, tests, the backtest and `npm run memory check` on every pull request to ensure memory files stay in sync with Git history.

## Codex Workflow

See `docs/CODEX_WORKFLOW.md` for tips on using the Codex agent effectively.

### Recommended Workflow

1. Run `npm ci` once when you start a session.
2. Run `npm run codex && npm run auto` to print the context block and process the next task.
3. Review `memory.log` for the latest summary line.
4. Open `TASKS.md` and complete the next task.
5. Commit messages must start with `Task <number>:`. The `commit-msg` hook runs
   `commitlint` to verify this format.
6. A pre-commit hook greps `.git/COMMIT_EDITMSG` for `^Task [0-9]+:` and aborts
   if the pattern is missing before running lint, tests and memory checks. This
   hook **does not** modify or rotate memory files.
7. After each commit a single `post-commit` hook runs
   `node --loader ts-node/esm scripts/update-memory.ts`.
   This script appends the commit to `memory.log`, updates `context.snapshot.md`,
   rotates the log to 300 lines and validates memory consistency. Rotation only
   happens here, never during pre-commit.
8. When resuming after a break, tail the end of `memory.log` to review recent commits.
9. Test and backtest outputs are logged in `logs/`.

### Generating Context

Run `npm run codex` to print the memory preamble generated by `scripts/codex_context.sh`.
Paste this block into the chat when starting a new Codex session.

```bash
npm run codex
```

Example output:

```text
[MEMORY PREAMBLE—DO NOT EDIT BELOW]
Recent commits (333 tokens):
• chore(ci): update action versions (#239) –
...
Pending tasks (333 tokens):
Task 95: create memory CLI with rotate, snapshot-rotate, status, grep, update-log
[END MEMORY PREAMBLE]
```

## Automation Scripts

| Command | Purpose |
| ------- | ------- |
| `npm run auto` | Execute the AutoTaskRunner to process tasks in `TASKS.md`; installs dependencies once then validates memory after each commit |
| `npm run memory` | Consolidated memory CLI with subcommands like `rotate`, `check`, `diff`, `grep`, `status`, `list` and `clean-locks` |
| `node --loader ts-node/esm scripts/update-memory.ts` | Update `memory.log`, `context.snapshot.md`, rotate the log and validate memory |
| `ts-node scripts/rebuild-memory.ts [path]` | Rebuild `memory.log` and `context.snapshot.md` from git history |
| `ts-node scripts/memory-json.ts` | Export `memory.log` lines to `memory.json` |
| `ts-node scripts/snapshot-json.ts` | Export `context.snapshot.md` to `snapshot.json` |
| `npm run setup-hooks` | Install pre-commit and post-commit hooks for automatic memlog checks |
| `npm run dev-deps` | Install dev dependencies if `node_modules` is missing; uses `.cache/node_modules.tar.gz` to speed up reinstalls |
| `bash scripts/check-env.sh` | Verify required CLIs (`next`, `jest`, `ts-node`) are installed |
| `node scripts/try-cmd.js <cmd>` | Run a command only if the binary exists |
| `npm run backtest` | Launch the backtest defined in `scripts/backtest.ts` |

Use `MEM_ROTATE_LIMIT` or a numeric argument to `npm run memory rotate` to change the number of retained lines.

## Rotating Memory Files

Keep `memory.log` and `context.snapshot.md` trimmed so the agent loads quickly:

```bash
npm run memory rotate          # prune memory.log
npm run memory snapshot-rotate # prune context.snapshot.md
```

### Manual Archival

Use the `memory archive` subcommand to stash the current memory files before
resetting them. Restore later with `memory restore`:

```bash
npm run memory archive                # moves memory.log and snapshot to ./logs/archive/
npm run memory restore <file> memory  # restore memory.log from a backup
npm run memory restore <file> snapshot # restore context.snapshot.md
```

A weekly GitHub workflow automatically runs `npm run memory rotate` and `npm run memory clean-locks` to push the
latest trimmed logs. Set `MEM_PATH` and `SNAPSHOT_PATH` if your memory files live elsewhere and
adjust `MEM_ROTATE_LIMIT` and `SNAP_ROTATE_LIMIT` to control the number of retained entries.
`LOCK_TTL` defines how old `.lock` files must be before `clean-locks` deletes them.

The memory scripts honor several environment variables:

- `MEM_PATH` – path to `memory.log` (default: `<repo>/memory.log`)
- `SNAPSHOT_PATH` – path to `context.snapshot.md` (default: `<repo>/context.snapshot.md`)
- `MEM_ROTATE_LIMIT` – entries kept by `npm run memory rotate` (default: `300`)
- `SNAP_ROTATE_LIMIT` – entries kept by `npm run memory snapshot-rotate` (default: `100`)
- `LOCK_TTL` – milliseconds before `npm run memory clean-locks` removes `.lock` files (default: `300000`)
- `MEMORY_API_TTL` – seconds API responses are cached (default: `15`)

Example:

```bash
# Rotate custom logs and limits
MEM_PATH=/tmp/mem.log \
SNAPSHOT_PATH=/tmp/snapshot.md \
MEM_ROTATE_LIMIT=300 \
SNAP_ROTATE_LIMIT=150 \
npm run memory rotate && npm run memory snapshot-rotate
```

## Using Codex with Persistent Memory

See [CODEX_START.md](CODEX_START.md) for full instructions on launching Codex with persistent memory.
\nTest change for post-commit verification.
